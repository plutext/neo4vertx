<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-09-03 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20140903" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Development Team Documentation - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<link rel="shortcut icon" href="favicon.gif" type="image/x-icon"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                                <img src="neo4vertx_small.png" />
                </div>
                      </div>
        <div class="pull-right">              <div id="bannerRight">
                <h2>Neo4Vertx Documentation</h2>
                </div>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-09-03
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.4.0-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Intro</li>
                              
      <li>
  
                          <a href="wheretostart.html" title="Where to start?">
          <i class="none"></i>
        Where to start?</a>
            </li>
                
      <li>
  
                          <a href="changelog.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                
      <li>
  
                          <a href="javadoc" title="JavaDoc">
          <i class="none"></i>
        JavaDoc</a>
            </li>
                
      <li>
  
                          <a href="downloads.html" title="Downloads">
          <i class="none"></i>
        Downloads</a>
            </li>
                              <li class="nav-header">Examples</li>
                              
      <li class="active">
  
            <a href="#"><i class="none"></i>JavaScript</a>
          </li>
                
      <li>
  
                          <a href="example_cluster.html" title="Cluster Mode (Java)">
          <i class="none"></i>
        Cluster Mode (Java)</a>
            </li>
                
      <li>
  
                          <a href="example_remote.html" title="Remote Mode (Java)">
          <i class="none"></i>
        Remote Mode (Java)</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>neo4vertx JavaScript Example</h1>
<p>This example shows the basic usage of neo4vertx. This example is only meant to show conceptually how neo4vertx works. We send a Cypher query directly from the client.js, utilizing the Vert.x eventbus Javascript bridge. In real life you should probably not do this, as exposing the Cypher REST api in this way will effectively allow anyone with access to your site to fire ANY kind of Cypher REST query at your Neo4j instance.</p>
<p>Ideally, one would create backend verticles that handle all sorts of abstract things, utilizing neo4vertx; the client.js would then talk to these backend verticles instead!</p>
<p>Follow the steps below to run the example.</p>
<div class="section">
<div class="section">
<h3>Start the application<a name="Start_the_application"></a></h3>

<blockquote>
<p>vertx run app.js</p>
</blockquote>
<p>If this is the first time you run the example, you&#x2019;ll see vertx downloading and deploying 2 modules (mod-web-server and ofcourse neo4vertx). Now that the modules are deployed, let&#x2019;s run the example:</p></div>
<div class="section">
<h3>Run the example<a name="Run_the_example"></a></h3>
<p>Open <a class="externalLink" href="http://localhost:8080/">http://localhost:8080/</a> in a webbrowser to run the example (you can see the output of client.js in the webconsole). It should look something like this:</p>

<div class="source">
<pre>&quot;Eventbus connected&quot;
&quot;displayResult() received the following result: &quot;
Object { columns: Array[1], data: Array[0] }
</pre></div></div>
<div class="section">
<h3>Open the neo4j browser<a name="Open_the_neo4j_browser"></a></h3>
<p>Open <a class="externalLink" href="http://localhost:7474/">http://localhost:7474/</a> to see the neo4j browser.</p>
<hr />
<h1>Some more details</h1>
<p>Now that we&#x2019;ve succesfully run the example, let&#x2019;s take a closer look at the code. The application basically consists of 3 files:</p>

<ul>
  
<li>app.js (server-side code)</li>
  
<li>web/client.js (client-side code)</li>
  
<li>web/index.html (the delivery method for the client-side code)</li>
</ul>
<p>Let&#x2019;s take a look at the server-side code!</p></div></div>
<div class="section">
<h2>Server-side code (app.js)<a name="Server-side_code_app.js"></a></h2>
<div class="section">
<h3>Requires<a name="Requires"></a></h3>
<p>First off, we include container and console.</p>

<div class="source">
<pre>var container = require(&quot;vertx/container&quot;),
    console = require(&quot;vertx/console&quot;);
</pre></div></div>
<div class="section">
<h3>Configure the modules<a name="Configure_the_modules"></a></h3>
<p>Then we&#x2019;ll define the configuration for the two modules which we&#x2019;ll deploy; <i>mod-web-server</i> and <i>neo4vertx</i>. The configuration parameters all pretty much speak for themselves, for complete information see <a class="externalLink" href="https://github.com/vert-x/mod-web-server#configuration">mod-web-server </a> and <a class="externalLink" href="https://github.com/raaftech/neo4vertx#configuration">neo4vertx</a> configuration documentation.</p>

<div class="source">
<pre>// webserver configuration
var webServerConfig = {
    port: 8080,
    host: &quot;0.0.0.0&quot;,
    bridge: true,
    inbound_permitted: [
        { address_re: 'neo4j-graph.*' }
    ]
};
// neo4vertx configuration
var neo4jConfig = {
    mode: &quot;default&quot;,
    path: &quot;/tmp/db&quot;,
    baseAddress: &quot;neo4j-graph&quot;
};
</pre></div></div>
<div class="section">
<h3>Deploy the modules<a name="Deploy_the_modules"></a></h3>
<p>On the server-side we deploy a webserver-module and the neo4vertx module:</p>

<div class="source">
<pre>// deploy mod-web-server
container.deployModule(&quot;io.vertx~mod-web-server~2.0.0-final&quot;, webServerConfig, 1, deploymentCompleteHandler);

// deploy neo4vertx
container.deployModule(&quot;org.openpcf~neo4vertx~1.3.2&quot;, neo4jConfig, 1, deploymentCompleteHandler);
</pre></div></div>
<div class="section">
<h3>Deployment results<a name="Deployment_results"></a></h3>
<p>Each deployment calls <i>deploymentCompleteHandler(error, deploymentID)</i> when it&#x2019;s done deploying this notifies the user of the deploymentID when the deployment succeeded or the error if something went wrong.</p>

<div class="source">
<pre>// display deployment status
function deploymentCompleteHandler(error, deploymentID){
    if (error) {
        console.log(&quot;Something went wrong with deployment: &quot;);
        console.log(error)
    } else {
        console.log(&quot;Deployment Completed succesfully, deployment ID: &quot; + deploymentID);
    }
}
</pre></div></div></div>
<div class="section">
<h2>Client-side code (client.js)<a name="Client-side_code_client.js"></a></h2>
<div class="section">
<h3>Connect to the EventBus<a name="Connect_to_the_EventBus"></a></h3>
<p>On the client-side we create a new EventBus:</p>

<div class="source">
<pre>var eventBus = new vertx.EventBus(window.location.protocol + '//' +
                            window.location.hostname + ':' +
                            window.location.port + '/eventbus');
</pre></div></div>
<div class="section">
<h3>Query function<a name="Query_function"></a></h3>
<p>We define a function <i>doQuery(querystring, callback)</i> which sends a querystring on the eventbus to be executed and calls the <i>callback</i> with the results.</p>

<div class="source">
<pre>// Execute a Cypher query and call the callback with the results
function doQuery(querystring, callback) {

    // Json object containing our very simple querystring
    var queryJsonObject = { &quot;query&quot;: querystring };

    // Put the query message on the eventbus
    eventBus.send(
        'neo4j-graph.cypher.query',
        queryJsonObject,
        callback
    );
}
</pre></div></div>
<div class="section">
<h3>Callback function<a name="Callback_function"></a></h3>
<p>The callback <i>displayResults(results)</i> notifies the user on the console what the results were.</p>

<div class="source">
<pre>function displayResult(result) { 
    
    // Display query result(s)
    console.log(&quot;displayResult() received the following result: &quot;);
    console.log(result);
}
</pre></div></div>
<div class="section">
<h3>Execute a query<a name="Execute_a_query"></a></h3>
<p>As soon as we&#x2019;re connected to the eventbus (<i>eventBus.onopen</i>), we notify the user of this through the console, execute a Cypher query (using <i>doQuery</i> defined earlier) and then display the results using the passed callback (<i>displayResults</i>).</p>

<div class="source">
<pre>// Fire when connected to the eventbus
eventBus.onopen = function eventbusConnected() {

  // Our very simple query string
  var simpleQuerystring = &quot;MATCH (n) RETURN n&quot;;

  // Notify user that eventbus is connected
  console.log(&quot;Eventbus connected&quot;);
  
  // Execute a Cypher query and use callbackFunction() to display the results
  doQuery(simpleQuerystring, displayResult);
}
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2014
                        <a href="https://www.openpcf.org/">Open Provisioning and Control Framework</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>